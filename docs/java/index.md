---
title: Java9ï½19æ–°ç‰¹æ€§
order: 1
---

## è¯´æ˜

è¯¥æ¨¡å—æ˜¯ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…äº†è§£å„ä¸ªç‰ˆæœ¬æ–°ç‰¹æ€§ã€‚ä»…é’ˆå¯¹è¾ƒä¸ºçªå‡ºçš„ä¾¿äºç†è§£çš„ç‰¹æ€§è¿›è¡Œè¯´æ˜ã€‚

> **SpringBoot3.xé»˜è®¤JDKç‰ˆæœ¬æ˜¯17ã€‚**

Javaç‰ˆæœ¬æ—¶é—´ï¼ŒJava8ç«Ÿç„¶åˆ°2030å¹´ğŸ¶ï¼Œè€Œjava17æ‰åˆ°2029å¹´ã€‚

![Javaç‰ˆæœ¬æ—¶é—´](https://breeze.fanzy.cn/java_timeline.png)

## Java9 æ–°ç‰¹æ€§

### æ¥å£ç§æœ‰æ–¹æ³•

åœ¨jdk9ä¸­æ–°å¢äº†æ¥å£ç§æœ‰æ–¹æ³•ï¼Œå³æˆ‘ä»¬å¯ä»¥åœ¨æ¥å£ä¸­å£°æ˜privateä¿®é¥°çš„æ–¹æ³•äº†ï¼Œè¿™æ ·çš„è¯ï¼Œæ¥å£è¶Šæ¥è¶ŠåƒæŠ½è±¡ç±»ã€‚

```java
public interface MyInterface {
    //å®šä¹‰ç§æœ‰æ–¹æ³•
    private void m1() {
        System.out.println("123");
    }
    //defaultä¸­è°ƒç”¨
    default void m2() {
        m1();
    }
}
```

### æ”¹è¿›try with resource

åœ¨Java7ä¸­æ–°å¢äº†try with
resourceè¯­æ³•ç”¨æ¥è‡ªåŠ¨å…³é—­èµ„æºæ–‡ä»¶ï¼Œåœ¨IOæµå’Œjdbcéƒ¨åˆ†ä½¿ç”¨çš„æ¯”è¾ƒå¤šã€‚ä½¿ç”¨æ–¹å¼æ˜¯å°†éœ€è¦è‡ªåŠ¨å…³é—­çš„èµ„æºå¯¹è±¡çš„åˆ›å»ºæ”¾åˆ°tryåé¢çš„å°æ‹¬å·ä¸­ï¼Œåœ¨jdk9ä¸­æˆ‘ä»¬å¯ä»¥å°†è¿™äº›èµ„æºå¯¹è±¡çš„åˆ›å»ºä»£ç æ”¾åˆ°å°æ‹¬å·å¤–é¢ï¼Œç„¶åå°†éœ€è¦å…³é—­çš„å¯¹è±¡åæ”¾åˆ°tryåé¢çš„å°æ‹¬å·ä¸­å³å¯ã€‚

```java
public class TryWithResource {
    public static void main(String[] args) throws FileNotFoundException {
        //jdk8ä»¥å‰
        try (FileInputStream fileInputStream = new FileInputStream("");
             FileOutputStream fileOutputStream = new FileOutputStream("")) {

        } catch (IOException e) {
            e.printStackTrace();
        }

        //jdk9
        FileInputStream fis = new FileInputStream("");
        FileOutputStream fos = new FileOutputStream("");
        //å¤šèµ„æºç”¨åˆ†å·éš”å¼€
        try (fis; fos) {
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### ä¸èƒ½ä½¿ç”¨ä¸‹åˆ’çº¿å‘½åå˜é‡

ä¸‹é¢è¯­å¥åœ¨jdk9ä¹‹å‰å¯ä»¥æ­£å¸¸ç¼–è¯‘é€šè¿‡,ä½†æ˜¯åœ¨jdk9ï¼ˆå«ï¼‰ä¹‹åç¼–è¯‘æŠ¥é”™ï¼Œåœ¨åé¢çš„ç‰ˆæœ¬ä¸­ä¼šå°†ä¸‹åˆ’çº¿ä½œä¸ºå…³é”®å­—æ¥ä½¿ç”¨

```java
String _ = "test";
```

### Stringå­—ç¬¦ä¸²çš„å˜åŒ–

**åº•å±‚ç”±charæ•°ç»„æ”¹æˆäº†byteæ•°æ®ï¼Œå½“å­—ç¬¦ä¸²ä¸ºçº¯è‹±æ–‡æ˜¯å ç”¨ç©ºé—´å‡å°‘ä¸€åŠã€‚**

å†™ç¨‹åºçš„æ—¶å€™ä¼šç»å¸¸ç”¨åˆ°Stringå­—ç¬¦ä¸²ï¼Œåœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­Stringå†…éƒ¨ä½¿ç”¨äº†`char`
æ•°ç»„å­˜å‚¨ï¼Œå¯¹äºä½¿ç”¨è‹±è¯­çš„äººæ¥è¯´ï¼Œä¸€ä¸ªå­—ç¬¦ç”¨ä¸€ä¸ªå­—èŠ‚å°±èƒ½å­˜å‚¨ï¼Œä½¿ç”¨charå­˜å‚¨å­—ç¬¦ä¼šæµªè´¹ä¸€åŠçš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤åœ¨jdk9ä¸­å°†Stringå†…éƒ¨çš„`charæ•°ç»„`
æ”¹æˆäº†`byteæ•°ç»„`ï¼Œè¿™æ ·å°±èŠ‚çœäº†ä¸€åŠçš„å†…å­˜å ç”¨ã€‚

```java
char c = 'a';//2ä¸ªå­—èŠ‚
byte b = 97;//1ä¸ªå­—èŠ‚
```

Stringä¸­å¢åŠ äº†ä¸‹é¢2ä¸ªæˆå‘˜å˜é‡

- `COMPACT_STRINGS`ï¼šåˆ¤æ–­æ˜¯å¦å‹ç¼©ï¼Œé»˜è®¤æ˜¯trueï¼Œè‹¥ä¸ºfalseï¼Œåˆ™ä¸å‹ç¼©ï¼Œä½¿ç”¨UTF16ç¼–ç ã€‚
- `coder`ç”¨æ¥åŒºåˆ†ä½¿ç”¨çš„å­—ç¬¦ç¼–ç ï¼Œåˆ†åˆ«ä¸ºLATIN1ï¼ˆå€¼ä¸º0ï¼‰å’ŒUTF16ï¼ˆå€¼ä¸º1ï¼‰ã€‚

> byteæ•°ç»„å¦‚ä½•å­˜å‚¨ä¸­æ–‡å‘¢ï¼Ÿé€šè¿‡æºç ï¼ˆStringUTF16ç±»ä¸­çš„toBytesæ–¹æ³•ï¼‰å¾—çŸ¥ï¼Œåœ¨ä½¿ç”¨ä¸­æ–‡å­—ç¬¦ä¸²æ—¶ï¼Œ1ä¸ªä¸­æ–‡ä¼šè¢«å­˜å‚¨åˆ°byteæ•°ç»„ä¸­çš„ä¸¤ä¸ªå…ƒç´ ä¸Šï¼Œå³å­˜å‚¨1ä¸ªä¸­æ–‡ï¼Œbyteæ•°ç»„é•¿åº¦ä¸º2ï¼Œå­˜å‚¨2ä¸ªä¸­æ–‡ï¼Œbyteæ•°ç»„é•¿åº¦ä¸º4ã€‚

### @Deprecatedæ³¨è§£çš„å˜åŒ–

è¯¥æ³¨è§£ç”¨äºæ ‡è¯†åºŸå¼ƒçš„å†…å®¹ï¼Œåœ¨jdk9ä¸­æ–°å¢äº†2ä¸ªå†…å®¹ï¼š

- `String since() default ""`ï¼šæ ‡è¯†æ˜¯ä»å“ªä¸ªç‰ˆæœ¬å¼€å§‹åºŸå¼ƒ
- `boolean forRemoval() default false`ï¼šæ ‡è¯†è¯¥åºŸå¼ƒçš„å†…å®¹ä¼šåœ¨æœªæ¥çš„æŸä¸ªç‰ˆæœ¬ä¸­ç§»é™¤

### æ¨¡å—åŒ–

**æ¨¡å—åŒ–å¸¦æ¥çš„ç›´è§‚æ„Ÿå—æ˜¯jvmå†…å­˜å‡å°‘ï¼Œå¦‚åœ¨å¼€å‘webé¡¹ç›®ä¸­ï¼Œä¸éœ€è¦awtåŒ…ï¼Œç°åœ¨å¯ä»¥ä¸å¼•å…¥ã€‚**

java8ä¸­æœ‰ä¸ªéå¸¸é‡è¦çš„åŒ…rt.jarï¼Œé‡Œé¢æ¶µç›–äº†javaæä¾›çš„ç±»æ–‡ä»¶ï¼Œåœ¨ç¨‹åºå‘˜è¿è¡Œjavaç¨‹åºæ—¶jvmä¼šåŠ è½½rt.jarã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ˜¯rt.jarä¸­çš„æŸäº›æ–‡ä»¶æˆ‘ä»¬æ˜¯ä¸ä¼šä½¿ç”¨çš„ï¼Œæ¯”å¦‚ä½¿ç”¨javaå¼€å‘æœåŠ¡å™¨ç«¯ç¨‹åºçš„æ—¶å€™é€šå¸¸ç”¨ä¸åˆ°å›¾å½¢åŒ–ç•Œé¢çš„åº“java.awtï¼‰ï¼Œè¿™å°±é€ æˆäº†å†…å­˜çš„æµªè´¹ã€‚

java9ä¸­å°†rt.jaråˆ†æˆäº†ä¸åŒçš„æ¨¡å—ï¼Œä¸€ä¸ªæ¨¡å—ä¸‹å¯ä»¥åŒ…å«å¤šä¸ªåŒ…ï¼Œæ¨¡å—ä¹‹é—´å­˜åœ¨ç€ä¾èµ–å…³ç³»ï¼Œå…¶ä¸­java.baseæ¨¡å—æ˜¯åŸºç¡€æ¨¡å—ï¼Œä¸ä¾èµ–å…¶ä»–æ¨¡å—ã€‚ä¸Šé¢æåˆ°çš„java.awtè¢«æ”¾åˆ°äº†å…¶ä»–æ¨¡å—ä¸‹ï¼Œè¿™æ ·åœ¨ä¸ä½¿ç”¨è¿™ä¸ªæ¨¡å—çš„æ—¶å€™å°±æ— éœ€è®©jvmåŠ è½½ï¼Œå‡å°‘å†…å­˜æµªè´¹ã€‚è®©jvmåŠ è½½ç¨‹åºçš„å¿…è¦æ¨¡å—ï¼Œå¹¶éå…¨éƒ¨æ¨¡å—ï¼Œè¾¾åˆ°äº†ç˜¦èº«æ•ˆæœã€‚

æ¨¡å—åŒ–çš„ä¼˜ç‚¹ï¼š

- ç²¾ç®€jvmåŠ è½½çš„classç±»ï¼Œæå‡åŠ è½½é€Ÿåº¦
- å¯¹åŒ…æ›´ç²¾ç»†çš„æ§åˆ¶ï¼Œæé«˜å®‰å…¨

## Java10

### å±€éƒ¨å˜é‡ç±»å‹æ¨æ–­

> **å½“ç„¶è¿™ä¸ªvarçš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ï¼Œä»…é€‚ç”¨äºå±€éƒ¨å˜é‡ï¼Œå¢å¼ºforå¾ªç¯çš„ç´¢å¼•ï¼Œä»¥åŠæ™®é€šforå¾ªç¯çš„æœ¬åœ°å˜é‡ï¼›**
>
> **å®ƒä¸èƒ½ä½¿ç”¨äºæ–¹æ³•å½¢å‚ï¼Œæ„é€ æ–¹æ³•å½¢å‚ï¼Œæ–¹æ³•è¿”å›ç±»å‹ç­‰ã€‚**

```java
// jdk10ä¹‹å‰
String a = "jack";
int b = 10;
long c = 88888888L;
Object d = new Object();
// jdk10ä¹‹å
var a = "jack";
var b = 10;
var c = 88888888L;
var d = new Object();
```

## Java11 LTS

### ç›´æ¥è¿è¡Œ

åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬åœ¨å‘½ä»¤æç¤ºä¸‹ï¼Œéœ€è¦å…ˆç¼–è¯‘ï¼Œç”Ÿæˆclassæ–‡ä»¶ä¹‹åå†è¿è¡Œï¼Œä¾‹å¦‚:

```shell
javac HelloWorld.java
java HelloWorld
```

åœ¨java 11ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç›´æ¥è¿è¡Œ

```shell
java HelloWorld.java
```

### Stringæ–°å¢æ–¹æ³•

#### stripæ–¹æ³•

stripæ–¹æ³•ï¼Œå¯ä»¥å»é™¤é¦–å°¾ç©ºæ ¼ï¼Œä¸ä¹‹å‰çš„trimçš„åŒºåˆ«æ˜¯è¿˜å¯ä»¥å»é™¤unicodeç¼–ç çš„ç©ºç™½å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š

```java
char c = '\u2000';//Unicdoeç©ºç™½å­—ç¬¦
String str = c + "abc" + c;
System.out.println(str.strip());
System.out.println(str.trim());

System.out.println(str.stripLeading());//å»é™¤å‰é¢çš„ç©ºæ ¼
System.out.println(str.stripTrailing());//å»é™¤åé¢çš„ç©ºæ ¼
```

#### isBlankæ–¹æ³•

sBlankæ–¹æ³•ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²é•¿åº¦æ˜¯å¦ä¸º0ï¼Œæˆ–è€…æ˜¯å¦æ˜¯ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ç­‰å…¶ä»–ç©ºç™½å­—ç¬¦ã€‚

```java
String str = " ";
System.out.println(str.isBlank());
```

#### repeatæ–¹æ³•

repeatæ–¹æ³•ï¼Œå­—ç¬¦ä¸²é‡å¤çš„æ¬¡æ•°ã€‚

```java
String str = "abc";
System.out.println(str.repeat(4));
```

### lambdaè¡¨è¾¾å¼ä¸­çš„å˜é‡ç±»å‹æ¨æ–­

jdk11ä¸­å…è®¸åœ¨lambdaè¡¨è¾¾å¼çš„å‚æ•°ä¸­ä½¿ç”¨varä¿®é¥°ã€‚

```java
@FunctionalInterface
public interface MyInterface {
   void m1(String a, int b);
}
```

æµ‹è¯•ç±»ï¼š

```java
 MyInterface mi = (var a,var b)->{
       System.out.println(a);
       System.out.println(b);
   };
   mi.m1("abc",123);
```

## Java12

### å‡çº§çš„switchè¯­å¥ã€Œé¢„è§ˆç‰ˆã€

åœ¨jdk12ä¹‹å‰çš„switchè¯­å¥ä¸­ï¼Œå¦‚æœæ²¡æœ‰å†™breakï¼Œåˆ™ä¼šå‡ºç°caseç©¿é€ç°è±¡ï¼Œä¸‹é¢æ˜¯å¯¹caseç©¿é€çš„ä¸€ä¸ªåº”ç”¨ï¼Œæ ¹æ®è¾“å…¥çš„æœˆä»½æ‰“å°ç›¸åº”çš„å­£èŠ‚ã€‚

```java
int month = 3;
switch (month) {
    case 3:
    case 4:
    case 5:
        System.out.println("spring");
    break;
    case 6:
    case 7:
    case 8:
        System.out.println("summer");
    break;
    case 9:
    case 10:
    case 11:
        System.out.println("autumn");
    break;
    case 12:
    case 1:
    case 2:
        System.out.println("winter");
    break;
    default:
        System.out.println("wrong");
    break;
}
```

åœ¨jdk12ä¹‹åæˆ‘ä»¬<u>å¯ä»¥çœç•¥å…¨éƒ¨çš„breakå’Œéƒ¨åˆ†case</u>ï¼Œè¿™æ ·ä½¿ç”¨

```java
int month = 3;
switch (month) {
    case 3,4,5 -> System.out.println("spring");
    case 6,7,8 -> System.out.println("summer");
    case 9,10,11 -> System.out.println("autumn");
    case 12, 1,2 -> System.out.println("winter");
    default -> System.out.println("wrong");
}
```

## Java13

### å‡çº§çš„switchè¯­å¥ã€Œé¢„è§ˆç‰ˆã€

jdk13ä¸­å¯¹switchè¯­å¥åˆè¿›è¡Œäº†å‡çº§ï¼Œ<u>å¯ä»¥switchçš„è·å–è¿”å›å€¼</u>ã€‚

ç¤ºä¾‹ï¼š

```java
int month = 3;
String result = switch (month) {
    case 3,4,5 -> "spring";
    case 6,7,8 -> "summer";
    case 9,10,11 -> "autumn";
    case 12, 1,2 -> "winter";
    default -> "wrong";
};

System.out.println(result);
```

### æ–‡æœ¬å—çš„å˜åŒ–

åœ¨jdk13ä¹‹å‰çš„ç‰ˆæœ¬ä¸­å¦‚æœè¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æœ‰æ¢è¡Œçš„è¯ï¼Œéœ€è¦æ·»åŠ æ¢è¡Œç¬¦

```java
String s = "Hello\nWorld\nLearn\nJava";
```

jdk13ä¹‹åå¯ä»¥ç›´æ¥è¿™æ ·å†™ï¼Œè¿™æ ·çš„å­—ç¬¦ä¸²æ›´åŠ ä¸€ç›®äº†ç„¶ã€‚

```java
String s = """
            Hello
            World
            Learn
            Java
           """;
```

## Java14

> jdk12å’Œjdk13ä¸­é¢„è§ˆç‰ˆçš„switchç‰¹æ€§ï¼Œåœ¨jdk14ä¸­å·²ç»æ˜¯æ­£å¼çš„è¯­æ³•äº†ã€‚

### instanceofæ¨¡å¼åŒ¹é…ã€Œé¢„è§ˆç‰ˆã€

è¯¥ç‰¹æ€§å¯ä»¥å‡å°‘å¼ºåˆ¶ç±»å‹è½¬æ¢çš„æ“ä½œï¼Œç®€åŒ–äº†ä»£ç ï¼Œä»£ç ç¤ºä¾‹ï¼š

```java
public class TestInstanceof{
    public static void main(String[] args){

        //jdk14ä¹‹å‰çš„å†™æ³•
        Object obj = new Integer(1);
        if(obj instanceof Integer){
            Integer i = (Integer)obj;
            int result = i + 10;
            System.out.println(i);
        }

        //jdk14æ–°ç‰¹æ€§  ä¸ç”¨å†å¼ºåˆ¶è½¬æ¢äº†
        //è¿™é‡Œç›¸å½“äºæ˜¯å°†objå¼ºåˆ¶ä¸ºIntegerä¹‹åèµ‹å€¼ç»™iäº†
        if(obj instanceof Integer i){
            int result = i + 10;
            System.out.println(i);
        }else{
            //ä½œç”¨åŸŸé—®é¢˜ï¼Œè¿™é‡Œæ˜¯æ— æ³•è®¿é—®içš„
        }
    }
}
```

### å‹å¥½çš„ç©ºæŒ‡é’ˆï¼ˆNullPointerExceptionï¼‰æç¤º

jdk14ä¸­æ·»åŠ äº†å¯¹äºç©ºæŒ‡é’ˆå¼‚å¸¸å‹å¥½çš„æç¤ºï¼Œä¾¿äºå¼€å‘è€…å¿«é€Ÿå®šä½ç©ºæŒ‡é’ˆçš„å¯¹è±¡ã€‚ç¤ºä¾‹ä»£ç ï¼š

```java
class Machine{
    public void start(){
        System.out.println("å¯åŠ¨");
    }
}

class Engine{
    public Machine machine;
}

class Car{
    public Engine engine;

}

public class TestNull{
    public static void main(String[] args){
        //è¿™é‡Œä¼šæŠ¥å‡ºç©ºæŒ‡é’ˆï¼Œä½†æ˜¯å“ªä¸ªå¯¹è±¡æ˜¯nullå‘¢ï¼Ÿ
        new Car().engine.machine.start();
    }
}
```

æˆ‘ä»¬åœ¨è¿è¡Œä¸Šé¢ä»£ç çš„æ—¶å€™ï¼Œé”™è¯¯ä¿¡æ¯å°±å¯ä»¥æ˜ç¡®çš„æŒ‡å‡ºé‚£ä¸ªå¯¹è±¡ä¸ºnulläº†ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ä¸‹é¢å‚æ•°æ¥æŸ¥çœ‹:

```shell
java -XX:+ShowCodeDetailsInExceptionMessages TestNull
```

### recordç±»å‹ã€Œé¢„è§ˆç‰ˆã€

ä¹‹å‰åœ¨ç¼–å†™javabeanç±»çš„æ—¶å€™ï¼Œéœ€è¦ç¼–å†™æˆå‘˜å˜é‡ï¼Œgetæ–¹æ³•ï¼Œæ„é€ æ–¹æ³•ï¼ŒtoStringæ–¹æ³•ï¼Œhashcodeæ–¹æ³•ï¼Œequalsæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•é€šå¸¸ä¼šé€šè¿‡å¼€å‘å·¥å…·æ¥ç”Ÿæˆï¼Œåœ¨jdk14ä¸­æ–°å¢äº†recordç±»å‹ï¼Œé€šè¿‡è¯¥ç±»å‹å¯ä»¥çœå»è¿™äº›ä»£ç çš„ç¼–å†™ã€‚

jdk14ç¼–å†™User

```java
public record User(String name,Integer age){}
```

ç¼–å†™æµ‹è¯•ç±»ï¼š

```java
public class TestUser{
    public static void main(String[] args){
        User u = new User("jack",15);
        System.out.println(u);
        System.out.println(u.name());
    }
}
```

è®°å½•ç±»å‹æœ‰è‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜ï¼ŒåŒ…æ‹¬ï¼š

- çŠ¶æ€æè¿°ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰å¯¹åº”çš„private finalå­—æ®µã€‚
- çŠ¶æ€æè¿°ä¸­çš„æ¯ä¸ªç»„ä»¶éƒ½æœ‰å¯¹åº”çš„publicè®¿é—®æ–¹æ³•ã€‚æ–¹æ³•çš„åç§°ä¸ç»„ä»¶åç§°ç›¸åŒã€‚
- ä¸€ä¸ªåŒ…å«å…¨éƒ¨ç»„ä»¶çš„å…¬å¼€æ„é€ å™¨ï¼Œç”¨æ¥åˆå§‹åŒ–å¯¹åº”ç»„ä»¶ã€‚
- å®ç°äº†equals()å’ŒhashCode()æ–¹æ³•ã€‚equals()è¦æ±‚å…¨éƒ¨ç»„ä»¶éƒ½å¿…é¡»ç›¸ç­‰ã€‚
- å®ç°äº†toString()ï¼Œè¾“å‡ºå…¨éƒ¨ç»„ä»¶çš„ä¿¡æ¯ã€‚

## Java15

### Sealed Classes

å¯†å°ç±»å’Œæ¥å£ï¼Œä½œç”¨æ˜¯é™åˆ¶ä¸€ä¸ªç±»å¯ä»¥ç”±å“ªäº›å­ç±»ç»§æ‰¿æˆ–è€…å®ç°ã€‚

1. å¦‚æœæŒ‡å®šæ¨¡å—çš„è¯ï¼Œsealed classå’Œå…¶å­ç±»å¿…é¡»åœ¨åŒä¸€ä¸ªæ¨¡å—ä¸‹ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šæ¨¡å—ï¼Œåˆ™éœ€è¦åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ã€‚
2. sealed classæŒ‡å®šçš„å­ç±»å¿…é¡»ç›´æ¥ç»§æ‰¿è¯¥sealed classã€‚
3. sealed classçš„å­ç±»è¦ç”¨`final`ä¿®é¥°ã€‚
4. sealed classçš„å­ç±»å¦‚æœä¸æƒ³ç”¨`final`ä¿®é¥°çš„è¯ï¼Œå¯ä»¥å°†å­ç±»å£°æ˜ä¸ºsealed classã€‚

Animalç±»ï¼Œåœ¨æŒ‡å®šå…è®¸ç»§æ‰¿çš„å­ç±»æ—¶å¯ä»¥ä½¿ç”¨å…¨é™å®šå

```java
//å¤šä¸ªå­ç±»ä¹‹é—´ç”¨,éš”å¼€
public sealed class Animal permits Cat, Dog{
      public void eat(){}
}
```

Catç±»

```java
public final class Cat extends Animal{
    public void eat(){
        System.out.println("Cat123");
    }
}
```

Dogç±»

```java
public final class Dog extends Animal permits Husky {}
```

Huskyç±»

```java
public final class Husky extends Dog{
}
```

### CharSequenceæ–°å¢çš„æ–¹æ³•

è¯¥æ¥å£ä¸­æ–°å¢äº†defaultæ–¹æ³•isEmpty()ï¼Œä½œç”¨æ˜¯åˆ¤æ–­CharSequenceæ˜¯å¦ä¸ºç©ºã€‚

### TreeMapæ–°å¢æ–¹æ³•

- putIfAbsent
- computeIfAbsent
- computeIfPresent
- compute
- merge

### æ–‡æœ¬å—ç”±é¢„è§ˆç‰ˆå˜ä¸ºæ­£å¼ç‰ˆ

### æ— éœ€é…ç½®ç¯å¢ƒå˜é‡

winç³»ç»Ÿä¸­å®‰è£…å®Œæˆä¹‹åä¼šè‡ªåŠ¨å°†java.exe, javaw.exe, javac.exe, jshell.exeè¿™å‡ ä¸ªå‘½ä»¤æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ä¸­ã€‚è¿™éƒ¨åˆ†å¯ä»¥æ‰“å¼€ç¯å¢ƒå˜é‡çœ‹ä¸‹ã€‚

## Java16

### åŒ…è£…ç±»æ„é€ æ–¹æ³•çš„è­¦å‘Š

ä½¿ç”¨åŒ…è£…ç±»çš„æ„é€ æ–¹æ³•åœ¨ç¼–è¯‘çš„æ—¶å€™ä¼šå‡ºç°è­¦å‘Šï¼Œä¸å»ºè®®å†ä½¿ç”¨åŒ…è£…ç±»çš„æ„é€ æ–¹æ³•ã€‚ä¸‹é¢ä»£ç åœ¨javacç¼–è¯‘ä¹‹åä¼šå‡ºç°è­¦å‘Šã€‚

```java
Integer i = new Integer(8);
```

ä¸å»ºè®®ä½¿ç”¨åŒ…è£…ç±»ä½œä¸ºé”å¯¹è±¡ï¼Œå€˜è‹¥ä½¿ç”¨åŒ…è£…ç±»ä½œä¸ºé”å¯¹è±¡ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šå‡ºç°è­¦å‘Šã€‚

```java
Integer i = 8;
synchronized(i){

}
```

### æ–°å¢æ—¥æ—¶æ®µ

åœ¨DateTimeFormatter.ofPatternä¼ å…¥Bå¯ä»¥è·å–ç°åœ¨æ—¶é—´å¯¹åº”çš„æ—¥æ—¶æ®µï¼Œä¸Šåˆï¼Œä¸‹åˆç­‰

```java
System.out.println(DateTimeFormatter.ofPattern("B").format(LocalDateTime.now()));
```

### InvocationHandleræ–°å¢æ–¹æ³•

åœ¨è¯¥æ¥å£ä¸­æ·»åŠ äº†ä¸‹é¢æ–¹æ³•

```java
public static Object invokeDefault(Object proxy, Method method, Object... args)
```

è¯¥æ–¹æ³•å¯ä»¥è°ƒç”¨çˆ¶æ¥å£ä¸­defalutæ–¹æ³•ï¼Œæ¯”å¦‚æœ‰ä¸‹é¢æ¥å£

```java
interface Girl{
    default void eat(){
        System.out.println("cucumber");
    }

}
```

å®ç°ç±»

```java
public class Lucy implements Girl{
    public void eat(){
        System.out.println("banana");
    }
}
```

æµ‹è¯•ç±»

```java
public class Test{
    public static void main(String[] args) {
        Girl girl = new Lucy();


        //ä¸ä½¿ç”¨invokeDefaultä¼šè°ƒç”¨é‡å†™çš„eatæ–¹æ³•
        Girl proxy1 = (Girl)Proxy.newProxyInstance(girl.getClass().getClassLoader(),girl.getClass().getInterfaces(),
            (obj,method,params)->{
            Object invoke = method.invoke(girl);
            return invoke;
        });
        proxy1.eat();

        //ä½¿ç”¨invokeDefaultä¼šè°ƒç”¨çˆ¶æ¥å£ä¸­çš„defaultæ–¹æ³•
        Girl proxy2 = (Girl)Proxy.newProxyInstance(Girl.class.getClassLoader(),new Class<?>[]{Girl.class},
            (obj,method,params)->{
            if (method.isDefault()) {
                return InvocationHandler.invokeDefault(obj, method, params);
            }
            return null;
        });
        proxy2.eat();

    }

}
```

### å…¶ä»–

åœ¨ä¹‹å‰jdkç‰ˆæœ¬ä¸­ä½œä¸ºé¢„è§ˆåŠŸèƒ½çš„Recordç±»ï¼Œæ¨¡å¼åŒ¹é…çš„instanceofï¼Œæ‰“åŒ…å·¥å…·jpackageï¼Œå·²æˆä¸ºæ­£å¼ç‰ˆã€‚jdk16å¯¹GCï¼Œjvmè¿è¡Œæ—¶å†…å­˜ç­‰å†…å®¹æœ‰ä¸€äº›å˜åŒ–ï¼Œä¾‹å¦‚ï¼š
**ZGCå¹¶å‘æ ˆå¤„ç†**ï¼Œ**å¼¹æ€§meta space**ã€‚

## Java17 LTS

> SpringBoot 3.xä¹‹åé»˜è®¤JDKç‰ˆæœ¬ä¸º17ã€‚

java17æ˜¯ä¸€ä¸ªLTSï¼ˆlong term
supportï¼‰é•¿æœŸæ”¯æŒçš„ç‰ˆæœ¬ï¼Œæ ¹æ®è®¡åˆ’æ¥çœ‹java17ä¼šæ”¯æŒåˆ°2029å¹´ï¼ˆjava8ä¼šæ”¯æŒåˆ°2030å¹´ï¼ŒOMGï¼‰ï¼ŒåŒæ—¶Oracleæè®®ä¸‹ä¸€ä¸ªLTSç‰ˆæœ¬æ˜¯java21ï¼Œåœ¨2023å¹´9æœˆå‘å¸ƒï¼Œè¿™æ ·è®²LSTç‰ˆæœ¬çš„å‘å¸ƒå‘¨æœŸç”±ä¹‹å‰çš„3å¹´å˜ä¸ºäº†2å¹´ã€‚è¿™é‡Œåªä»‹ç»ä¸€äº›è·Ÿå¼€å‘å…³è”åº¦è¾ƒå¤§çš„ç‰¹æ€§ï¼Œé™¤æ­¤ä¹‹å¤–JDK17è¿˜æ›´æ–°äº†ä¸€äº›å…¶ä»–æ–°ç‰¹æ€§ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ä»è¿™é‡ŒæŸ¥çœ‹ï¼š[Oracle Releases Java 17](https://www.oracle.com/news/announcement/oracle-releases-java-17-2021-09-14/)

### switchè¯­æ³•çš„å˜åŒ–(é¢„è§ˆ)

åœ¨ä¹‹å‰ç‰ˆæœ¬ä¸­æ–°å¢çš„instanceofæ¨¡å¼åŒ¹é…çš„ç‰¹æ€§åœ¨switchä¸­ä¹Ÿæ”¯æŒäº†ï¼Œå³æˆ‘ä»¬å¯ä»¥åœ¨switchä¸­å‡å°‘å¼ºè½¬çš„æ“ä½œã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š

Rabbitå’ŒBirdå‡å®ç°äº†Animalæ¥å£

```java
interface Animal{}

class Rabbit implements Animal{
    //ç‰¹æœ‰çš„æ–¹æ³•
    public void run(){
        System.out.println("run");
    }
}

class Bird implements Animal{
    //ç‰¹æœ‰çš„æ–¹æ³•
    public void fly(){
        System.out.println("fly");
    }
}
```

æ–°ç‰¹æ€§å¯ä»¥å‡å°‘Animalå¼ºè½¬æ“ä½œä»£ç çš„ç¼–å†™ï¼š

```java
public class Switch01{
    public static void main(String[] args) {
        Animal a = new Rabbit();
        animalEat(a);
    }

    public static void animalEat(Animal a){
        switch(a){
            //å¦‚æœaæ˜¯Rabbitç±»å‹ï¼Œåˆ™åœ¨å¼ºè½¬ä¹‹åèµ‹å€¼ç»™rï¼Œç„¶åå†è°ƒç”¨å…¶ç‰¹æœ‰çš„runæ–¹æ³•
            case Rabbit r -> r.run();
            //å¦‚æœaæ˜¯Birdç±»å‹ï¼Œåˆ™åœ¨å¼ºè½¬ä¹‹åèµ‹å€¼ç»™bï¼Œç„¶åè°ƒç”¨å…¶ç‰¹æœ‰çš„flyæ–¹æ³•
            case Bird b -> b.fly();
            //æ”¯æŒnullçš„åˆ¤æ–­
            case null -> System.out.println("null");
            default -> System.out.println("no animal");
        }
    }

}
```

### Sealed Classes

åœ¨jdk15ä¸­å·²ç»æ·»åŠ äº†Sealed Classesï¼Œåªä¸è¿‡å½“æ—¶æ˜¯ä½œä¸ºé¢„è§ˆç‰ˆï¼Œç»å†äº†2ä¸ªç‰ˆæœ¬ä¹‹åï¼Œåœ¨jdk17ä¸­Sealed Classeså·²ç»æˆä¸ºæ­£å¼ç‰ˆäº†ã€‚Sealed
Classesçš„ä½œç”¨æ˜¯å¯ä»¥é™åˆ¶ä¸€ä¸ªç±»æˆ–è€…æ¥å£å¯ä»¥ç”±å“ªäº›å­ç±»ç»§æ‰¿æˆ–è€…å®ç°ã€‚

### ä¼ªéšæœºæ•°çš„å˜åŒ–

å¢åŠ äº†ä¼ªéšæœºæ•°ç›¸å…³çš„ç±»å’Œæ¥å£æ¥è®©å¼€å‘è€…ä½¿ç”¨streamæµè¿›è¡Œæ“ä½œ

- RandomGenerator
- RandomGeneratorFactory

ä¹‹å‰çš„java.util.Randomå’Œjava.util.concurrent.ThreadLocalRandoméƒ½æ˜¯RandomGeneratoræ¥å£çš„å®ç°ç±»ã€‚

### å»é™¤äº†AOTå’ŒJIT

AOTï¼ˆAhead-of-Timeï¼‰æ˜¯java9ä¸­æ–°å¢çš„åŠŸèƒ½ï¼Œå¯ä»¥å…ˆå°†åº”ç”¨ä¸­ä¸­çš„å­—èŠ‚ç ç¼–è¯‘æˆæœºå™¨ç ã€‚

Graalç¼–è¯‘å™¨ä½œä¸ºä½¿ç”¨javaå¼€å‘çš„JITï¼ˆjust-in-time ï¼‰å³æ—¶ç¼–è¯‘å™¨åœ¨java10ä¸­åŠ å…¥ï¼ˆæ³¨æ„è¿™é‡Œçš„JITä¸æ˜¯ä¹‹å‰javaä¸­çš„JITï¼Œåœ¨JEP
317ä¸­æœ‰è¯´æ˜https://openjdk.java.net/jeps/317ï¼‰ã€‚

## Java18

### é»˜è®¤ä½¿ç”¨UTF-8å­—ç¬¦ç¼–ç 

ä»jdk18å¼€å§‹ï¼Œé»˜è®¤ä½¿ç”¨UTF-8å­—ç¬¦ç¼–ç ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å¦‚ä¸‹å‚æ•°ä¿®æ”¹å…¶ä»–å­—ç¬¦ç¼–ç ï¼š

```shell
-Dfile.encoding=UTF-8 
```

### ç®€å•çš„webæœåŠ¡å™¨

å¯ä»¥é€šè¿‡jwebserverå‘½ä»¤å¯åŠ¨jdk18ä¸­æä¾›çš„é™æ€webæœåŠ¡å™¨ï¼Œå¯ä»¥åˆ©ç”¨è¯¥å·¥å…·æŸ¥çœ‹ä¸€äº›åŸå‹ï¼Œåšç®€å•çš„æµ‹è¯•ã€‚åœ¨å‘½ä»¤æç¤ºç¬¦ä¸­è¾“å…¥jwebserverå‘½ä»¤åä¼šå¯åŠ¨ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥:[http://127.0.0.1:8000/](http://127.0.0.1:8000/)
å³å¯çœ‹åˆ°å½“å‰å‘½ä»¤æç¤ºç¬¦è·¯å¾„ä¸‹çš„æ–‡ä»¶äº†ã€‚

### å°†è¢«ç§»é™¤çš„æ–¹æ³•

åœ¨jdk18ä¸­æ ‡è®°äº†Objectä¸­çš„finalizeæ–¹æ³•ï¼ŒThreadä¸­çš„stopæ–¹æ³•å°†åœ¨æœªæ¥è¢«ç§»é™¤ã€‚

### @snippetæ³¨è§£

ä»¥å‰åœ¨æ–‡æ¡£æ³¨é‡Šä¸­ç¼–å†™ä»£ç æ—¶éœ€è¦æ·»åŠ codeæ ‡ç­¾ï¼Œä½¿ç”¨è¾ƒä¸ºä¸ä¾¿ï¼Œé€šè¿‡@snippetæ³¨è§£å¯ä»¥æ›´æ–¹ä¾¿çš„å°†æ–‡æ¡£æ³¨é‡Šä¸­çš„ä»£ç å±•ç¤ºåœ¨apiæ–‡æ¡£ä¸­ã€‚

## Java19

### Virtual Threads (Preview)ï¼ˆè™šæ‹Ÿçº¿ç¨‹ï¼‰

#### ç®€ä»‹

è¯¥ç‰¹æ€§åœ¨java19ä¸­æ˜¯é¢„è§ˆç‰ˆï¼Œè™šæ‹Ÿçº¿ç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€ä¸‹çš„çº¿ç¨‹ï¼Œç±»ä¼¼goè¯­è¨€ä¸­çš„goroutines
å’ŒErlangä¸­çš„processesï¼Œè™šæ‹Ÿçº¿ç¨‹å¹¶éæ¯”çº¿ç¨‹å¿«ï¼Œè€Œæ˜¯æé«˜äº†åº”ç”¨çš„ååé‡ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„çº¿ç¨‹æ˜¯ç”±æ“ä½œç³»ç»Ÿè°ƒåº¦æ¥çœ‹ï¼Œè™šæ‹Ÿçº¿ç¨‹æ˜¯æˆ‘ä»¬è‡ªå·±ç¨‹åºè°ƒåº¦çš„çº¿ç¨‹ã€‚å¦‚æœä½ å¯¹ä¹‹å‰javaæä¾›çš„çº¿ç¨‹APIæ¯”è¾ƒç†Ÿæ‚‰äº†ï¼Œé‚£ä¹ˆåœ¨å­¦ä¹ è™šæ‹Ÿçº¿ç¨‹çš„æ—¶å€™ä¼šæ¯”è¾ƒè½»æ¾ï¼Œä¼ ç»Ÿçº¿ç¨‹èƒ½è¿è¡Œçš„ä»£ç ï¼Œè™šæ‹Ÿçº¿ç¨‹ä¹Ÿå¯ä»¥è¿è¡Œã€‚è™šæ‹Ÿçº¿ç¨‹çš„å‡ºç°ï¼Œå¹¶æ²¡æœ‰ä¿®æ”¹javaåŸæœ‰çš„å¹¶å‘æ¨¡å‹ï¼Œä¹Ÿä¸ä¼šæ›¿ä»£åŸæœ‰çš„çº¿ç¨‹ã€‚
**è™šæ‹Ÿçº¿ç¨‹ä¸»è¦ä½œç”¨æ˜¯æå‡æœåŠ¡å™¨ç«¯çš„ååé‡ã€‚**

#### ååé‡çš„ç“¶é¢ˆ

æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ä¼¸ç¼©æ€§å—åˆ©ç‰¹å°”æ³•åˆ™ï¼ˆLittleâ€™s Lawï¼‰çš„åˆ¶çº¦ï¼Œä¸ä¸‹é¢3ç‚¹æœ‰å…³

1. å»¶è¿Ÿï¼šè¯·æ±‚å¤„ç†çš„è€—æ—¶
2. å¹¶å‘é‡ï¼šåŒä¸€æ—¶åˆ»å¤„ç†çš„è¯·æ±‚æ•°é‡
3. ååé‡ï¼šå•ä½æ—¶é—´å†…å¤„ç†çš„æ•°æ®æ•°é‡

æ¯”å¦‚ä¸€ä¸ªæœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„å»¶è¿Ÿæ˜¯50msï¼Œå¤„ç†10ä¸ªå¹¶å‘è¯·æ±‚ï¼Œåˆ™ååé‡æ˜¯200è¯·æ±‚/ç§’ï¼ˆ10 /
0.05ï¼‰ï¼Œå¦‚æœååé‡è¦è¾¾åˆ°2000è¯·æ±‚/ç§’ï¼Œåˆ™å¤„ç†çš„å¹¶å‘è¯·æ±‚æ•°é‡æ˜¯100ã€‚æŒ‰ç…§1ä¸ªè¯·æ±‚å¯¹åº”ä¸€ä¸ªçº¿ç¨‹çš„æ¯”ä¾‹æ¥çœ‹ï¼Œè¦æƒ³æé«˜ååé‡ï¼Œçº¿ç¨‹æ•°é‡ä¹Ÿè¦å¢åŠ ã€‚

javaä¸­çš„çº¿ç¨‹æ˜¯åœ¨æ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼ˆOS threadï¼‰è¿›è¡Œäº†ä¸€å±‚åŒ…è£…ï¼Œè€Œæ“ä½œç³»ç»Ÿä¸­çº¿ç¨‹æ˜¯é‡é‡çº§èµ„æºï¼Œåœ¨ç¡¬ä»¶é…ç½®ç¡®å®šçš„å‰æä¸‹ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åˆ›å»ºæ›´å¤šçš„çº¿ç¨‹äº†ï¼Œæ­¤æ—¶çº¿ç¨‹æ•°é‡å°±é™åˆ¶äº†ç³»ç»Ÿæ€§èƒ½ï¼Œä¸ºäº†è§£å†³è¯¥é—®é¢˜ï¼Œè™šæ‹Ÿçº¿ç¨‹å°±å‡ºç°äº†ã€‚

#### è™šæ‹Ÿçº¿ç¨‹çš„åº”ç”¨åœºæ™¯

åœ¨æœåŠ¡å™¨ç«¯çš„åº”ç”¨ç¨‹åºä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¤§é‡çš„å¹¶å‘ä»»åŠ¡éœ€è¦æ‰§è¡Œï¼Œè€Œè™šæ‹Ÿçº¿ç¨‹èƒ½å¤Ÿæ˜æ˜¾çš„æé«˜åº”ç”¨çš„ååé‡ã€‚ä¸‹é¢çš„åœºæ™¯èƒ½å¤Ÿæ˜¾è‘—çš„æé«˜ç¨‹åºçš„ååé‡ï¼š

- è‡³å°‘å‡ åƒçš„å¹¶å‘ä»»åŠ¡é‡
- ä»»åŠ¡ä¸ºioå¯†é›†å‹

ä¸‹é¢ä»£ç ä¸­ä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œå½“ä»»åŠ¡é‡è¾ƒå¤šçš„æ—¶å€™ï¼Œä½ çš„ç”µè„‘å¯ä»¥æ„Ÿå—åˆ°æ˜æ˜¾çš„å¡é¡¿ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥å¢åŠ ä»»åŠ¡æ•°é‡è¯•ä¸‹ï¼‰ï¼š

```java
//ExecutorServiceå®ç°äº†AutoCloseableæ¥å£ï¼Œå¯ä»¥è‡ªåŠ¨å…³é—­äº†
try (ExecutorService executor = Executors.newCachedThreadPool()) {
    //å‘executorä¸­æäº¤1000000ä¸ªä»»åŠ¡
    IntStream.range(0, 1000000).forEach(
        i -> {
            executor.submit(() -> {
                try {
                    //ç¡çœ 1ç§’ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                    Thread.sleep(Duration.ofSeconds(1));
                    System.out.println("æ‰§è¡Œä»»åŠ¡:" + i);
                } catch (InterruptedException e) {
                    e.printStackTrace();
                }

            });
        });
} catch (Exception e) {
    e.printStackTrace();
}
```

å°†ä¸Šé¢çš„ä»£ç æ”¹æˆè™šæ‹Ÿçº¿ç¨‹ä¹‹åï¼Œç”µè„‘ä¸ä¼šæ„Ÿå—åˆ°å¡é¡¿äº†ï¼š

```java
//newVirtualThreadPerTaskExecutorä¸ºæ¯ä¸ªä»»åŠ¡åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹
try (ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor()) {
    IntStream.range(0, 1000_000).forEach(i -> {
        executor.submit(() -> {
            try {
                //ç¡çœ 1ç§’ï¼Œæ¨¡æ‹Ÿè€—æ—¶æ“ä½œ
                Thread.sleep(Duration.ofSeconds(1));
                System.out.println("æ‰§è¡Œä»»åŠ¡:" + i);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        });
    });
} 
```

#### å¹³å°çº¿ç¨‹å’Œè™šæ‹Ÿçº¿ç¨‹

å¹³å°çº¿ç¨‹ï¼ˆplatform threadï¼‰ï¼šæŒ‡javaä¸­çš„çº¿ç¨‹ï¼Œæ¯”å¦‚é€šè¿‡Executors.newFixedThreadPool()åˆ›å»ºå‡ºæ¥çš„çº¿ç¨‹ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºå¹³å°çº¿ç¨‹ã€‚

è™šæ‹Ÿçº¿ç¨‹å¹¶ä¸ä¼šç›´æ¥åˆ†é…ç»™cpuå»æ‰§è¡Œï¼Œè€Œæ˜¯é€šè¿‡è°ƒåº¦å™¨åˆ†é…ç»™å¹³å°çº¿ç¨‹ï¼Œå¹³å°çº¿ç¨‹å†è¢«è°ƒåº¦å™¨ç®¡ç†ã€‚javaä¸­è™šæ‹Ÿçº¿ç¨‹çš„è°ƒåº¦å™¨é‡‡ç”¨äº†å·¥ä½œçªƒå–çš„æ¨¡å¼è¿›è¡ŒFIFOçš„æ“ä½œï¼Œè°ƒåº¦å™¨çš„å¹¶è¡Œæ•°é»˜è®¤æ˜¯jvmè·å–çš„å¤„ç†å™¨æ•°é‡ï¼ˆé€šè¿‡è¯¥æ–¹æ³•è·å–çš„æ•°é‡Runtime.getRuntime()
.availableProcessors()ï¼‰ï¼Œè°ƒåº¦å™¨å¹¶éåˆ†æ—¶ï¼ˆtime sharingï¼‰çš„ã€‚åœ¨ä½¿ç”¨è™šæ‹Ÿçº¿ç¨‹ç¼–å†™ç¨‹åºæ—¶ï¼Œä¸èƒ½æ§åˆ¶è™šæ‹Ÿçº¿ç¨‹ä½•æ—¶åˆ†é…ç»™å¹³å°çº¿ç¨‹ï¼Œä¹Ÿä¸èƒ½æ§åˆ¶å¹³å°çº¿ç¨‹ä½•æ—¶åˆ†é…ç»™cpuã€‚

#### æºå¸¦å™¨

è°ƒåº¦å™¨å°†è™šæ‹Ÿçº¿ç¨‹æŒ‚è½½åˆ°å¹³å°çº¿ç¨‹ä¹‹åï¼Œè¯¥å¹³å°çº¿ç¨‹å«åšè™šæ‹Ÿçº¿ç¨‹çš„æºå¸¦å™¨ï¼Œè°ƒåº¦å™¨å¹¶ä¸ç»´æŠ¤è™šæ‹Ÿçº¿ç¨‹å’Œæºå¸¦å™¨ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œå› æ­¤åœ¨ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸä¸­å¯ä»¥è¢«åˆ†é…åˆ°ä¸åŒçš„æºå¸¦å™¨ï¼Œå³è™šæ‹Ÿçº¿ç¨‹è¿è¡Œäº†ä¸€å°æ®µä»£ç åï¼Œå¯èƒ½ä¼šè„±ç¦»æºå¸¦å™¨ï¼Œæ­¤æ—¶å…¶ä»–çš„è™šæ‹Ÿçº¿ç¨‹ä¼šè¢«åˆ†é…åˆ°è¿™ä¸ªæºå¸¦å™¨ä¸Šã€‚

æºå¸¦å™¨å’Œè™šæ‹Ÿçº¿ç¨‹æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œæ¯”å¦‚ï¼š

- è™šæ‹Ÿçº¿ç¨‹ä¸èƒ½ä½¿ç”¨æºå¸¦å™¨çš„æ ‡è¯†ï¼ŒThread.current()æ–¹æ³•è·å–çš„æ˜¯è™šæ‹Ÿçº¿ç¨‹æœ¬èº«ã€‚
- ä¸¤è€…æœ‰å„è‡ªçš„æ ˆç©ºé—´ã€‚
- ä¸¤è€…ä¸èƒ½è®¿é—®å¯¹æ–¹çš„Thread Localå˜é‡ã€‚

åœ¨ç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œè™šæ‹Ÿçº¿ç¨‹é‡åˆ°é˜»å¡çš„æ“ä½œæ—¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¼šè¢«è§£é™¤æŒ‚è½½ï¼Œé˜»å¡ç»“æŸåï¼Œè™šæ‹Ÿçº¿ç¨‹ä¼šè¢«è°ƒåº¦å™¨é‡æ–°æŒ‚è½½åˆ°æºå¸¦å™¨ä¸Šï¼Œå› æ­¤è™šæ‹Ÿçº¿ç¨‹ä¼šé¢‘ç¹çš„æŒ‚è½½å’Œè§£é™¤æŒ‚è½½ï¼Œè¿™å¹¶ä¸ä¼šå¯¼è‡´æ“ä½œç³»ç»Ÿçº¿ç¨‹çš„é˜»å¡ã€‚ä¸‹é¢çš„ä»£ç åœ¨æ‰§è¡Œä¸¤ä¸ªgetæ–¹æ³•å’Œsendæ–¹æ³•ï¼ˆä¼šæœ‰ioæ“ä½œï¼‰æ—¶ä¼šä½¿è™šæ‹Ÿçº¿ç¨‹å‘ç”ŸæŒ‚è½½å’Œè§£é™¤æŒ‚è½½ï¼š

```java
response.send(future1.get() + future2.get());
```

æœ‰äº›é˜»å¡æ“ä½œå¹¶ä¸ä¼šå¯¼è‡´è™šæ‹Ÿçº¿ç¨‹è§£é™¤æŒ‚è½½ï¼Œè¿™æ ·ä¼šåŒæ—¶é˜»å¡æºå¸¦å™¨å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹ï¼Œä¾‹å¦‚ï¼šæ“ä½œç³»ç»ŸåŸºæœ¬çš„æ–‡ä»¶æ“ä½œï¼Œjavaä¸­çš„Object.wait()
æ–¹æ³•ã€‚ä¸‹é¢ä¸¤ç§æƒ…å†µä¸ä¼šå¯¼è‡´è™šæ‹Ÿçº¿ç¨‹çš„è§£é™¤æŒ‚è½½ï¼š

1. æ‰§è¡ŒsynchronizedåŒæ­¥ä»£ç ï¼ˆä¼šå¯¼è‡´æºå¸¦å™¨é˜»å¡ï¼Œæ‰€ä»¥å»ºè®®ä½¿ç”¨ReentrantLockæ›¿æ¢æ‰synchronizedï¼‰
2. æ‰§è¡Œæœ¬åœ°æ–¹æ³•æˆ–å¤–éƒ¨å‡½æ•°

#### è™šæ‹Ÿçº¿ç¨‹å’Œå¹³å°çº¿ç¨‹apiçš„åŒºåˆ«

ä»å†…å­˜ç©ºé—´ä¸Šæ¥è¯´ï¼Œè™šæ‹Ÿçº¿ç¨‹çš„æ ˆç©ºé—´å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¤§å—çš„æ ˆå¯¹è±¡ï¼Œå®ƒè¢«å­˜å‚¨åœ¨äº†javaå †ä¸­ï¼Œç›¸æ¯”äºå•ç‹¬å­˜å‚¨å¯¹è±¡ï¼Œå †ä¸­å­˜å‚¨è™šæ‹Ÿçº¿ç¨‹çš„æ ˆä¼šé€ æˆä¸€äº›ç©ºé—´çš„æµªè´¹ï¼Œè¿™ç‚¹åœ¨åç»­çš„javaç‰ˆæœ¬ä¸­åº”è¯¥ä¼šå¾—åˆ°æ”¹å–„ï¼Œå½“ç„¶è¿™æ ·ä¹Ÿæ˜¯æœ‰ä¸€äº›å¥½å¤„çš„ï¼Œå°±æ˜¯å¯ä»¥é‡å¤åˆ©ç”¨è¿™éƒ¨åˆ†æ ˆç©ºé—´ï¼Œä¸ç”¨å¤šæ¬¡ç”³è¯·å¼€è¾Ÿæ–°çš„å†…å­˜åœ°å€ã€‚è™šæ‹Ÿçº¿ç¨‹çš„æ ˆç©ºé—´æœ€å¤§å¯ä»¥è¾¾åˆ°å¹³å°çº¿ç¨‹çš„æ ˆç©ºé—´å®¹é‡ã€‚

**è™šæ‹Ÿçº¿ç¨‹å¹¶ä¸æ˜¯GC rootï¼Œå…¶ä¸­çš„å¼•ç”¨ä¸ä¼šå‡ºç°stop-worldï¼Œå½“è™šæ‹Ÿçº¿ç¨‹è¢«é˜»å¡ä¹‹åæ¯”å¦‚BlockingQueue.take()
ï¼Œå¹³å°çº¿ç¨‹æ—¢ä¸èƒ½è·å–åˆ°è™šæ‹Ÿçº¿ç¨‹ï¼Œä¹Ÿä¸èƒ½è·å–åˆ°queueé˜Ÿåˆ—ï¼Œè¿™æ ·è¯¥å¹³å°çº¿ç¨‹å¯èƒ½ä¼šè¢«å›æ”¶æ‰ï¼Œè™šæ‹Ÿçº¿ç¨‹åœ¨è¿è¡Œæˆ–é˜»å¡æ—¶ä¸ä¼šè¢«GC**

- é€šè¿‡Threadæ„é€ æ–¹æ³•åˆ›å»ºçš„çº¿ç¨‹éƒ½æ˜¯å¹³å°çº¿ç¨‹
- è™šæ‹Ÿçº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œä¸èƒ½é€šè¿‡setDaemonæ–¹æ³•æ”¹æˆéå®ˆæŠ¤çº¿ç¨‹
- è™šæ‹Ÿçº¿ç¨‹çš„ä¼˜å…ˆçº§æ˜¯é»˜è®¤çš„5ï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼Œå°†æ¥çš„ç‰ˆæœ¬å¯èƒ½å…è®¸ä¿®æ”¹
- è™šæ‹Ÿçº¿ç¨‹ä¸æ”¯æŒstop()ï¼Œsuspend()ï¼Œresume()æ–¹æ³•

#### åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹çš„æ–¹å¼

javaä¸­åˆ›å»ºçš„è™šæ‹Ÿçº¿ç¨‹æœ¬è´¨éƒ½æ˜¯é€šè¿‡Thread.Builder.OfVirtualå¯¹è±¡è¿›è¡Œåˆ›å»ºçš„ï¼Œæˆ‘ä»¬åé¢å†æ¥è®¨è®ºè¿™ä¸ªå¯¹è±¡ï¼Œä¸‹é¢å…ˆçœ‹ä¸‹åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹çš„ä¸‰ç§æ–¹å¼ï¼š

**1.é€šè¿‡Thread.startVirtualThreadç›´æ¥åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹**

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println("æ‰§è¡Œä»»åŠ¡");
};

//åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹å°†ä»»åŠ¡taskä¼ å…¥å¹¶å¯åŠ¨
Thread.startVirtualThread(task);

//ä¸»çº¿ç¨‹ç¡çœ ï¼Œå¦åˆ™å¯èƒ½çœ‹ä¸åˆ°æ§åˆ¶å°çš„æ‰“å°
TimeUnit.SECONDS.sleep(1);
```

**2.ä½¿ç”¨Thread.ofVirtual()æ–¹æ³•åˆ›å»º**

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println(Thread.currentThread().getName());
};

//åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹å‘½åä¸ºè¯ºæ‰‹ï¼Œå°†ä»»åŠ¡taskä¼ å…¥
Thread vt1 = Thread.ofVirtual().name("è¯ºæ‰‹").unstarted(task);
vt1.start();//å¯åŠ¨è™šæ‹Ÿçº¿ç¨‹

//ä¸»çº¿ç¨‹ç¡çœ ï¼Œå¦åˆ™å¯èƒ½çœ‹ä¸åˆ°æ§åˆ¶å°çš„æ‰“å°
TimeUnit.SECONDS.sleep(1);
```

ä¹Ÿå¯ä»¥åœ¨åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹çš„æ—¶å€™ç›´æ¥å¯åŠ¨

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println(Thread.currentThread().getName());
};

//åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹å‘½åä¸ºè¯ºæ‰‹ï¼Œå°†ä»»åŠ¡taskä¼ å…¥å¹¶å¯åŠ¨
Thread vt1 = Thread.ofVirtual().name("è¯ºæ‰‹").start(task);

//ä¸»çº¿ç¨‹ç¡çœ ï¼Œå¦åˆ™å¯èƒ½çœ‹ä¸åˆ°æ§åˆ¶å°çš„æ‰“å°
TimeUnit.SECONDS.sleep(1);
```

**3.é€šè¿‡ExecutorServiceåˆ›å»º**ï¼Œä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ä¸€ä¸ªè™šæ‹Ÿçº¿ç¨‹ï¼Œä¸‹é¢ä»£ç ä¸­æäº¤äº†100ä¸ªä»»åŠ¡ï¼Œå¯¹åº”ä¼šæœ‰100ä¸ªè™šæ‹Ÿçº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚

```java
/*
    é€šè¿‡ExecutorServiceåˆ›å»ºè™šæ‹Ÿçº¿ç¨‹
    ExecutorServiceå®ç°äº†AutoCloseableæ¥å£ï¼Œå¯ä»¥è‡ªåŠ¨å…³é—­äº†
*/
try (ExecutorService executor = Executors.newVirtualThreadPerTaskExecutor()) {
    //å‘executorä¸­æäº¤100ä¸ªä»»åŠ¡
    IntStream.range(0, 100).forEach(i -> {
        executor.submit(() -> {
            //ç¡çœ 1ç§’
            try {
                Thread.sleep(Duration.ofSeconds(1));
                System.out.println(i);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }                    
        });
    });
}  
```

ç°åœ¨å¹³å°çº¿ç¨‹å’Œè™šæ‹Ÿçº¿ç¨‹éƒ½æ˜¯Threadçš„å¯¹è±¡ï¼Œé‚£è¯¥å¦‚ä½•åŒºåˆ†è¯¥å¯¹è±¡æ˜¯å¹³å°çº¿ç¨‹è¿˜æ˜¯è™šæ‹Ÿçº¿ç¨‹ï¼Ÿå¯ä»¥åˆ©ç”¨Threadä¸­çš„isVirtual()
æ–¹æ³•è¿›è¡Œåˆ¤æ–­ï¼Œè¿”å›trueè¡¨ç¤ºè™šæ‹Ÿçº¿ç¨‹ï¼š

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println("æ‰§è¡Œä»»åŠ¡");
};

//åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹å°†ä»»åŠ¡taskä¼ å…¥å¹¶å¯åŠ¨
Thread vt = Thread.startVirtualThread(task);
System.out.println(vt.isVirtual());
```

#### Thread.builderæ¥å£

åœ¨jdk19ä¸­æ–°å¢äº†ä¸€ä¸ªå¯†å°ï¼ˆsealedï¼‰æ¥å£Builderï¼Œè¯¥æ¥å£åªå…è®¸æœ‰ä¸¤ä¸ªå­æ¥å£ï¼š

- OfPlatformï¼šåˆ›å»ºå¹³å°çº¿ç¨‹çš„æ—¶å€™ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå¯†å°æ¥å£ï¼Œåªå…è®¸ThreadBuilders.PlatformThreadBuilderå®ç°ã€‚
- OfVirtualï¼šåˆ›å»ºè™šæ‹Ÿçº¿ç¨‹çš„æ—¶å€™ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå¯†å°æ¥å£ï¼Œåªå…è®¸ThreadBuilders.VirtualThreadBuilderå®ç°ã€‚

ä¸Šé¢3ç§åˆ›å»ºè™šæ‹Ÿçº¿ç¨‹çš„æ–¹å¼æœ¬è´¨éƒ½æ˜¯é€šè¿‡OfVirtualæ¥è¿›è¡Œåˆ›å»ºçš„ï¼ŒOfVirtualå’ŒOfPlatformæ¥å£ä¸­çš„apiå¾ˆå¤šæ˜¯ç›¸åŒçš„ï¼ŒOfPlatformä¸­çš„æ–¹æ³•æ›´å¤šï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬ä»¥OfPlatformä¸ºä¾‹æ¼”ç¤ºä»–çš„ä½¿ç”¨æ–¹å¼ã€‚

é€šè¿‡OfPlatformä¸­çš„factory()æ–¹æ³•å¯ä»¥åˆ›å»ºä¸€ä¸ªThreadFactoryçº¿ç¨‹å·¥å‚ï¼Œå­¦è¿‡çº¿ç¨‹æ± çš„åŒå­¦å¯¹å®ƒåº”è¯¥å¹¶ä¸é™Œç”Ÿï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºå‡ºå¹³å°çº¿ç¨‹å¯¹è±¡ã€‚

```java
ThreadFactory threadFactory = Thread.ofPlatform().factory();
```

é™¤äº†ä¸Šé¢çš„ç”¨æ³•ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºå¹³å°çº¿ç¨‹å¯¹è±¡

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println(Thread.currentThread().getName());
};

//å°†ä»»åŠ¡æ”¾åˆ°tçº¿ç¨‹ä¸­å¹¶è¿è¡Œ
Thread t = Thread.ofPlatform().start(task);
```

ä¸Šé¢åˆ›å»ºå¹³å°çº¿ç¨‹çš„æ–¹å¼è·Ÿä¹‹å‰çš„new Threadæ˜¯ä¸€æ ·çš„ï¼Œä¼˜ç‚¹æ˜¯æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å®ç°é“¾å¼ç¼–ç¨‹ï¼Œæ¯”å¦‚è¦è®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œçº¿ç¨‹åå­—ï¼Œå®ˆæŠ¤çº¿ç¨‹ï¼š

```java
//åˆ›å»ºä»»åŠ¡
Runnable task = () -> {
    System.out.println(Thread.currentThread().getName());
};

//é“¾å¼ç¼–ç¨‹
Thread.ofPlatform().name("å°").priority(Thread.MAX_PRIORITY).daemon(true).start(task);
```

#### è™šæ‹Ÿçº¿ç¨‹ä¸­çš„ThreadLocal

ç”±äºè™šæ‹Ÿçº¿ç¨‹çš„æ•°é‡ä¼šæ¯”è¾ƒå¤šï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ThreadLocalçš„æ—¶å€™ä¸€å®šè¦æ³¨æ„ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹åœ¨æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨ThreadLocalã€‚åœ¨Thread.Builderä¸­æä¾›äº†ä¸æ”¯æŒThreadLocalçš„æ–¹æ³•ã€‚

```java
Thread.ofVirtual().allowSetThreadLocals(false);
Thread.ofVirtual().inheritInheritableThreadLocals(false);
```

#### LockSupportå¯¹è™šæ‹Ÿçº¿ç¨‹çš„æ”¯æŒ

LockSupportæ˜¯æ”¯æŒè™šæ‹Ÿçº¿ç¨‹çš„ï¼Œå½“è°ƒç”¨park()æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿçº¿ç¨‹ä¼šè§£é™¤æŒ‚è½½ï¼Œè¿™æ ·å¹³å°çº¿ç¨‹å¯ä»¥æ‰§è¡Œå…¶ä»–çš„æ“ä½œï¼Œå½“è°ƒç”¨unpark()
æ–¹æ³•æ—¶ï¼Œè™šæ‹Ÿçº¿ç¨‹ä¼šè¢«è°ƒåº¦å™¨é‡æ–°æŒ‚è½½åˆ°å¹³å°çº¿ç¨‹ï¼Œå†ç»§ç»­å·¥ä½œã€‚

#### java.ioåŒ…ä¸‹ç±»çš„å˜åŒ–

ä¸ºäº†å‡å°‘å†…å­˜çš„ä½¿ç”¨ï¼ŒBufferedOutputStreamï¼ŒBufferedWriterï¼ŒOutputStreamWriterä¸­é»˜è®¤çš„åˆå§‹æ•°ç»„å¤§å°ç”±ä¹‹å‰çš„8192å˜æˆäº†512ã€‚
